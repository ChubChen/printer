/**
 * Created by w44 on 15-1-7.
 */


var ScanDateTrans = function () {
    var self = this;
    self.weekConf = [
        {"1": 1, "2": 2, "3": 4, "4": 8},
        {"5": 1, "6": 2, "7": 4}
    ];
    self.weekRow = 2;
    self.zongJinQiu = [
        {"0": 1, "1": 2, "2": 4, "3": 8},
        {"4": 1, "5": 2, "6": 4, "7": 8}
    ];
    self.zongJinQiuRow = 2;
    self.halfConf = [
        {"33": 1, "31": 2, "30": 4 },
        {"13": 1, "11": 2, "10": 4},
        {"03": 1, "01": 2, "00": 4}
    ];
    self.halfRow = 3;
    self.winConf = [
        {"3": 1, "1": 2, "0": 4}
    ];
    self.winRow = 1;
    self.scoreConf = [
        {"10": 1, "42": 2, "24": 4, "01": 8},
        {"20": 1, "50": 2, "05": 4, "02": 8},
        {"21": 1, "51": 2, "15": 4, "12": 8},
        {"30": 1, "52": 2, "25": 4, "03": 8},
        {"31": 1, "90": 2, "09": 4, "13": 8},
        {"32": 1, "00": 2, "33": 4, "23": 8},
        {"40": 1, "11": 2, "99": 4, "04": 8},
        {"41": 1, "22": 2, "14": 8}
    ];
    self.scoreRow = 8;
    self.mixConf = [
        {"023": 1, "021": 2, "020": 4},
        {"013": 1, "011": 2, "010": 4},
        {"0310": 1, "0342": 2, "0324": 4, "0301": 8},
        {"0320": 1, "0350": 2, "0305": 4, "0302": 8},
        {"0321": 1, "0351": 2, "0315": 4, "0312": 8},
        {"0330": 1, "0352": 2, "0325": 4, "0303": 8},
        {"0331": 1, "0390": 2, "0309": 4, "0313": 8},
        {"0332": 1, "0300": 2, "0333": 4, "0323": 8},
        {"0340": 1, "0311": 2, "0399": 4, "0304": 8},
        {"0341": 1, "0322": 2, "0314": 8},
        {"0433": 1, "0431": 2, "0430": 4 },
        {"0413": 1, "0411": 2, "0410": 4},
        {"0403": 1, "0401": 2, "0400": 4},
        {"050": 1, "051": 2, "052": 4, "053": 8},
        {"054": 1, "055": 2, "056": 4, "057": 8}
    ];
    self.mixRow = 15;
    self.shunXuArray = [1, 0, 2];
};


ScanDateTrans.prototype.jcScanNumberTrans = function (ticket) {
    var self = this;

    var numberArray = ticket.numbers.split(";");

    //组装
    var str = pTypePaper[ticket.gameCode + ticket.playTypeCode + ticket.betTypeCode];
    if (!str) {
        return null;
    }
    var tempLen = Math.ceil(numberArray.length / 3);
    for (var i = 0; i < tempLen; i++) {
        var weekDay = new Array();
        var matchArray = new Array();
        var resultArray = new Array();
        var playArray = new Array();
        for (var j = i * 3; j < i * 3 + 3; j++) {
            if (numberArray[j]) {
                var temp = numberArray[i].split("|");
                weekDay.push(temp[1].substr(temp[1].length - 4, 1));
                playArray.push(temp[0]);
                matchArray.push(temp[1].substr(temp[1].length - 3));
                resultArray.push(temp[2]);
            }
        }
        if(ticket.playTypeCode == "06"){
            str += "00 01 ";
        }
        str += self.trans(self.weekConf, self.weekRow, weekDay) + self.changciTrans(matchArray);
        if (ticket.playTypeCode == "01") { //让球胜平负
            str += self.trans(self.winConf, self.winRow, resultArray);
        }
        else if (ticket.playTypeCode == "02") { //胜平负
            str += self.trans(self.winConf, self.winRow, resultArray);
        }
        else if (ticket.playTypeCode == "04") {//总进球
            str += self.trans(self.zongJinQiu, self.zongJinQiuRow, resultArray);
        }
        else if (ticket.playTypeCode == "05") {//半全场
            str += self.trans(self.halfConf, self.halfRow, resultArray);
        }
        else if (ticket.playTypeCode == "03") {//比分
            str += self.trans(self.scoreConf, self.scoreRow, resultArray);
        }
        else if (ticket.playTypeCode == "06") {//混合
            str += self.transHun(self.mixConf, self.mixRow, resultArray , playArray);
        }
    }
    str += self.btypeTrans(ticket.betTypeCode, ticket.multiple);
    return str;
};

var pTypePaper = {
    //胜平负 3关扫描======================================
    'T510211': '01 1c 00 0d 00 0e 00 31 07 ',
    'T510221': '01 1c 00 0d 00 0e 00 31 07 ',
    'T510231': '01 1c 00 0d 00 0e 00 31 07 ',
    'T510233': '01 1c 00 0d 00 0e 00 31 07 ',
    'T510234': '01 1c 00 0d 00 0e 00 31 07 ',
    //胜平负 6关扫描======================================
    'T510241': '01 2c 00 0d 00 16 00 3a 0b ',
    'T510244': '01 2c 00 0d 00 16 00 3a 0b ',
    'T510245': '01 2c 00 0d 00 16 00 3a 0b ',
    'T510246': '01 2c 00 0d 00 16 00 3a 0b ',
    'T5102411': '01 2c 00 0d 00 16 00 3a 0b ',

    'T510251': '01 2c 00 0d 00 16 00 3a 0b ',
    'T510255': '01 2c 00 0d 00 16 00 3a 0b ',
    'T510256': '01 2c 00 0d 00 16 00 3a 0b ',
    'T5102510': '01 2c 00 0d 00 16 00 3a 0b ',
    'T5102516': '01 2c 00 0d 00 16 00 3a 0b ',
    'T5102520': '01 2c 00 0d 00 16 00 3a 0b ',
    'T5102526': '01 2c 00 0d 00 16 00 3a 0b ',

    'T510261': '01 2c 00 0d 00 16 00 3a 0b ',
    'T510266': '01 2c 00 0d 00 16 00 3a 0b ',
    'T510267': '01 2c 00 0d 00 16 00 3a 0b ',
    'T5102615': '01 2c 00 0d 00 16 00 3a 0b ',
    'T5102620': '01 2c 00 0d 00 16 00 3a 0b ',
    'T5102622': '01 2c 00 0d 00 16 00 3a 0b ',
    'T5102635': '01 2c 00 0d 00 16 00 3a 0b ',
    'T5102642': '01 2c 00 0d 00 16 00 3a 0b ',
    'T5102650': '01 2c 00 0d 00 16 00 3a 0b ',
    'T5102657': '01 2c 00 0d 00 16 00 3a 0b ',
    //胜平负 8关扫描======================================
    'T510271': '01 3c 00 0d 00 1e 00 50 0f ',
    'T510277': '01 3c 00 0d 00 1e 00 50 0f ',
    'T510278': '01 3c 00 0d 00 1e 00 50 0f ',
    'T5102721': '01 3c 00 0d 00 1e 00 50 0f ',
    'T5102735': '01 3c 00 0d 00 1e 00 50 0f ',
    'T51027120': '01 3c 00 0d 00 1e 00 50 0f ',

    'T510281': '01 3c 00 0d 00 1e 00 50 0f ',
    'T510288': '01 3c 00 0d 00 1e 00 50 0f ',
    'T510289': '01 3c 00 0d 00 1e 00 50 0f ',
    'T5102828': '01 3c 00 0d 00 1e 00 50 0f ',
    'T5102856': '01 3c 00 0d 00 1e 00 50 0f ',
    'T5102870': '01 3c 00 0d 00 1e 00 50 0f ',
    'T51028247': '01 3c 00 0d 00 1e 00 50 0f ',


    //比分 3关扫描======================================
    'T510311':'01 2a 00 0d 00 15 00 c2 0a ',
    'T510321':'01 2a 00 0d 00 15 00 c2 0a ',
    'T510331':'01 2a 00 0d 00 15 00 c2 0a ',
    'T510333':'01 2a 00 0d 00 15 00 c2 0a ',
    'T510334':'01 2a 00 0d 00 15 00 c2 0a ',

    //总进球 3关扫描======================================
    'T510411':'01 1e 00 0d 00 0f 00 93 07 ',
    'T510421':'01 1e 00 0d 00 0f 00 93 07 ',
    'T510431':'01 1e 00 0d 00 0f 00 93 07 ',
    'T510433':'01 1e 00 0d 00 0f 00 93 07 ',
    'T510434':'01 1e 00 0d 00 0f 00 93 07 ',

    //总进球 6关扫描======================================
    'T510441':'01 30 00 0d 00 18 00 38 0c ',
    'T510444':'01 30 00 0d 00 18 00 38 0c ',
    'T510445':'01 30 00 0d 00 18 00 38 0c ',
    'T510446':'01 30 00 0d 00 18 00 38 0c ',
    'T5104411':'01 30 00 0d 00 18 00 38 0c ',

    'T510451':'01 30 00 0d 00 18 00 38 0c ',
    'T510455':'01 30 00 0d 00 18 00 38 0c ',
    'T510456':'01 30 00 0d 00 18 00 38 0c ',
    'T5104510':'01 30 00 0d 00 18 00 38 0c ',
    'T5104516':'01 30 00 0d 00 18 00 38 0c ',
    'T5104520':'01 30 00 0d 00 18 00 38 0c ',
    'T5104526':'01 30 00 0d 00 18 00 38 0c ',

    'T510461':'01 30 00 0d 00 18 00 38 0c ',
    'T510466':'01 30 00 0d 00 18 00 38 0c ',
    'T510467':'01 30 00 0d 00 18 00 38 0c ',
    'T5104615':'01 30 00 0d 00 18 00 38 0c ',
    'T5104620':'01 30 00 0d 00 18 00 38 0c ',
    'T5104622':'01 30 00 0d 00 18 00 38 0c ',
    'T5104635':'01 30 00 0d 00 18 00 38 0c ',
    'T5104642':'01 30 00 0d 00 18 00 38 0c ',
    'T5104650':'01 30 00 0d 00 18 00 38 0c ',
    'T5104657':'01 30 00 0d 00 18 00 38 0c ',


    //半全场 3关扫描======================================
    'T510511': '01 20 00 0d 00 10 00 32 08 ',
    'T510521': '01 20 00 0d 00 10 00 32 08 ',
    'T510531': '01 20 00 0d 00 10 00 32 08 ',
    'T510533': '01 20 00 0d 00 10 00 32 08 ',
    'T510534': '01 20 00 0d 00 10 00 32 08 ',

    //混合投注 3关扫描======================================
    'T510611': '01 3c 00 0d 00 1e 00 55 0f 08 00 ',
    'T510621': '01 3c 00 0d 00 1e 00 55 0f 08 00 ',
    'T510631': '01 3c 00 0d 00 1e 00 55 0f 08 00 ',
    'T510633': '01 3c 00 0d 00 1e 00 55 0f 08 00 ',
    'T510634': '01 3c 00 0d 00 1e 00 55 0f 08 00 '



};


ScanDateTrans.prototype.trans = function (confObj, row, array) {
    var self = this;
    var resultArray = new Array();
    for (var i = 0; i < row; i++) {
        var bool = true;
        for (var j = 0; j < 3; j++) {
            if (j == 2 && bool) {
                bool = false;
                j--;
                resultArray.push(" 0");
                continue;
            }
            var result = 0;
            if (array[self.shunXuArray[j]]) {
                var tempArray = array[self.shunXuArray[j]].split(',');
                for (var k = 0; k < tempArray.length; k++) {
                    if (confObj[i][tempArray[k]]) {
                        result += confObj[i][tempArray[k]];
                    }
                }
            }
            resultArray.push(new Number(result).toString(16));
        }
        resultArray.push(" ");
    }
    return resultArray.join("");
};


ScanDateTrans.prototype.changciTrans = function (match) {
    var self = this;
    var Obj = {"0": "0", "1": "1", "2": "2", 3: "3", "4": "4", "5": "8", "6": "6", "7": "a", "8": "b", "9": "c"};
    var weekArray = new Array();
    for (var i = 0; i < 3; i++) {
        var bool = true;
        for (var j = 0; j < 3; j++) {
            if (j == 2 && bool) {
                bool = false;
                j--;
                weekArray.push(" 0");
                continue;
            }
            var tempArray = [0, 0, 0];
            if (match[self.shunXuArray[j]]) {
                tempArray = match[self.shunXuArray[j]].toString().split("").reverse();
            }
            weekArray.push(Obj[tempArray[i]]);
        }
        weekArray.push(" ");
    }
    return weekArray.join("");
};

ScanDateTrans.prototype.btypeTrans = function (bType, multiple) {
    var self = this;
    var resultArray = new Array();
    var betTypeConf = [
        [
            {"21": "1", "31": "2", "33": "4", "34": "8", "41": "1", "44": "2", "45": "4", "46": "8", "71": "1", "77": "2", "78": "4", "721": "8"},
            {"735": "1", "7120": "2", "411": "1", "11": "8"}
        ],
        [
            {"51": "1", "55": "2", "56": "4", "510": "8", "81": "1", "88": "2", "89": "4", "828": "8"},
            {"516": "1", "520": "2", "526": "4", "856": "1", "870": "2", "8247": "4"}
        ],
        [
            {"61": "1", "66": "2", "67": "4", "615": "8"},
            {"620": "1", "622": "2", "635": "4", "642": "8"}
        ],
        [
            {"650": "1", "657": "2"},
            {}
        ]
    ];
    var multiplePeizhi = {"0": "0", "1": "1", "2": "2", "3": "4", "4": "8", "5": "6", "6": "7", "7": "b", "8": "c", "9": "e", "10": "f"};
    var tenMultiple = {"0": "0", "1": "2", "2": "4", "3": "8", "4": "a", "5": "b", "6": "d"};
    resultArray.push("00 00 ");
    for (var i = 0; i < 4; i++) {
        var bool = true;
        for (var j = 0; j < 3; j++) {
            if (j == 2 && bool) {
                bool = false;
                j--;
                resultArray.push(" 0");
                continue;
            }
            if (j < 2) {
                if (betTypeConf[i][self.shunXuArray[j]][bType]) {
                    resultArray.push(betTypeConf[i][self.shunXuArray[j]][bType]);
                } else {
                    resultArray.push("0")
                }
            } else {
                if (i == 0) {
                    resultArray.push(multiplePeizhi[multiple % 10]);
                } else if (i == 1) {
                    resultArray.push("0");
                } else if (i == 2) {
                    if (multiple <= 60) {
                        resultArray.push(tenMultiple[Math.floor(multiple / 10)]);
                    } else if (multiple > 60) {
                        resultArray.push(tenMultiple[Math.floor(multiple / 10) - 5]);
                    } else {
                        resultArray.push("0");
                    }
                } else {
                    if (multiple > 60) {
                        resultArray.push("2");
                    } else {
                        resultArray.push("0");
                    }
                }
            }
        }
        resultArray.push(" ");
    }
    return resultArray.join("");
};


ScanDateTrans.prototype.transHun = function (confObj, row, array, playArray) {
    var self = this;
    var resultArray = new Array();
    resultArray.push("00 00 ");
    for (var i = 0; i < row; i++) {
        var bool = true;
        for (var j = 0; j < 3; j++) {
            if (j == 2 && bool) {
                bool = false;
                j--;
                resultArray.push(" 0");
                continue;
            }
            var result = 0;
            if (array[self.shunXuArray[j]]) {
                var tempArray = array[self.shunXuArray[j]].split(',');
                var playType = playArray[self.shunXuArray[j]];
                for (var k = 0; k < tempArray.length; k++) {
                    var temp = playType + tempArray[k];
                    if (confObj[i][temp]) {
                        result += confObj[i][temp];
                    }
                }
            }
            resultArray.push(new Number(result).toString(16));
        }
        resultArray.push(" ");
    }
    console.log(resultArray.join(""));
    return resultArray.join("");
};

var scanDateTrans = new ScanDateTrans();

module.exports = scanDateTrans;