/**
 * Created by w44 on 15-2-6.
 */


var CronJob = require('cron').CronJob;

var util = require('print_util');
var log = util.log;

var assist = require('print_assist');
var queryAssist = assist.queryAssist;

var memory = require('print_memory');
var webIo = memory.webIo;

var PageControl = function () {
};


PageControl.prototype.run = function () {
    var self = this;
    //等待队列消息
    self.waitQueen.start();
    self.successQueen.start();
    self.terminalCount.start();
};


PageControl.prototype.waitQueen = new CronJob('*/5 * * * * *', function () {
    log.info("-------通知------- 等待队列消息");
    queryAssist.getWaitQueen(function (err, termInfo) {
        if (err) {
            log.error(err);
        } else {
            webIo.io.emit('waitQueen', termInfo);
        }
    });
}, null, false, 'Asia/Chongqing');


PageControl.prototype.successQueen = new CronJob('*/5 * * * * *', function () {
    log.info("-------通知------- 成功队列消息");
    queryAssist.getSuccessQueen(function (err, res) {
        if (err) {
            log.error(err);
        } else {
            webIo.io.emit('successQueen', res);
        }
    });
}, null, false, 'Asia/Chongqing');


PageControl.prototype.terminalCount = new CronJob('*/3 * * * * *', function () {
    log.info("-------通知------- 终端机票数量消息");
    queryAssist.getTerminalCount(function (err, body) {
        if (err) {
            log.error(err);
        } else {
            webIo.io.emit('terminalCount', body);
        }
    });
}, null, false, 'Asia/Chongqing');


var pageControl = new PageControl();
module.exports = pageControl;





